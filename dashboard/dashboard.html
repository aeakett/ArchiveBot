<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="/assets/reset.css" />
    <link rel="stylesheet" type="text/css" href="/assets/app.css" />
    <title>ArchiveBot dashboard</title>
  </head>

  <body>
    <noscript>
      This dashboard is a Javascript monstrosity, yo.
    </noscript>

    <script type="text/javascript" src="/assets/jquery.js"></script>
    <script type="text/javascript" src="/assets/handlebars.js"></script>
    <script type="text/javascript" src="/assets/ember.js"></script>
    <script type="text/javascript" src="/assets/app.js"></script>

    <script type="text/javascript">
      (function () {
        "use strict";

        var Socket = "MozWebSocket" in window ? MozWebSocket : WebSocket;
        var ws = new Socket('ws://' + window.location.host + '/stream');
        var processor = window.Dashboard.messageProcessor;

        ws.onmessage = function(msg) {
          processor.process(msg.data);
        }
      })();
    </script>

    <script type="text/x-handlebars">
      <h1>#archivebot @ irc.efnet.net</h1>

      {{outlet}}
    </script>

    <script type="text/x-handlebars" data-template-name="index">
      {{#each job in jobs}}
        {{partial "job"}}
      {{else}}
        No running jobs
      {{/each}}
    </script>

    <script type="text/x-handlebars" data-template-name="proportion-view">
      <div class="ok proportion"></div>
      <div class="error proportion"></div>
    </script>

    <script type="text/x-handlebars" data-template-name="log-view">
      <ol>
        {{#each view.eventBuffer}}
          <li {{bind-attr class=classNames}}>
            {{text}}
          </li>
        {{else}}
          <li>No events</li>
        {{/each}}
      </ol>
    </script>

    <script type="text/x-handlebars" data-template-name="_job">
      {{#view Dashboard.JobView finishedBinding=job.finished
          identBinding=job.ident jobListBinding=Dashboard.messageProcessor}}
        <header>
          <h1 class="url">
            {{job.urlForDisplay}}
            {{#link-to 'history' job}}History{{/link-to}}
          </h1>
          <h1 class="ident terminal">{{job.ident}}</h1>
          {{view Dashboard.ProportionView okPercentageBinding=job.okPercentage
              errorPercentageBinding=job.errorPercentage}}
        </header>
        {{view Dashboard.LogView incomingBinding=job.latestEntries
            autoScrollBinding=job.autoScroll}}
        <section>
          <span class="downloaded">{{job.mibDownloaded}} MiB downloaded</span>
          <span>1xx: {{job.r1xx}}</span>
          <span>2xx: {{job.r2xx}}</span>
          <span>3xx: {{job.r3xx}}</span>
          <span>4xx: {{job.r4xx}}</span>
          <span>5xx: {{job.r5xx}}</span>
          <span>Unknown: {{job.runk}}</span>
          <div class="auto-scroll">
            <label>
              {{input type=checkbox checked=job.autoScroll}}
              Auto-scroll
            </label>
          </div>
        </section>
      {{/view}}
    </script>
  </body>
</html>

<!-- vim: set ts=2 sw=2 et tw=78: -->
